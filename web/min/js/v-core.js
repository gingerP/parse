vvMes={del:"Are you sure you want to delete?"};vv={log:"debug",_sys_:{console:{}}};"debug"===vv.log&&(vv._sys_.console.warn=console.warn,console.warn=function(a){var b=arguments,c=a.replace("%s",function(){return 1<=b.length?b[1]:""});"function"===typeof dhtmlx.message&&"string"===typeof a&&(dhtmlx.message.position="bottom",dhtmlx.message({type:"warning",text:c}));vv._sys_.console.warn.apply(console,b)});
vv.confirm=function(a,b,c,d){dhtmlx.confirm({title:d||"Warning",type:c||"confirm-warning",text:a,callback:b})};function BusinessRules(){}BusinessRules.prototype.addBRules=function(a){var b;this.brules=this.brules||{};for(var c in a)b=U.getRandomString(),this.brules[c+";__"+b]=a[c]};BusinessRules.prototype.runBRule=function(a,b){var c=null,d=Array.prototype.slice.call(arguments),e=null;d.splice(0,1);for(var f in this.brules)c=f.split(";"),e=this.getBRuleOperator(f),0>c.indexOf("__btn")&&this.bRuleEqualHandlers[e](a,f)&&this.brules[f].apply(this,[this].concat(d))};
BusinessRules.prototype.runButtonBRule=function(a,b){var c=null,d=Array.prototype.slice.call(arguments),e=null;d.splice(0,1);for(var f in this.brules)c=f.split(";"),e=this.getBRuleOperator(f),-1<c.indexOf("__btn")&&this.bRuleEqualHandlers[e](a,f)&&this.brules[f].apply(this,[this].concat(d))};BusinessRules.prototype.runPreRules=function(a){var b,c;for(c in this.brules)b=c.split(";"),-1<b.indexOf("__pre")&&this.brules[c].apply(this,[this].concat(a))};
BusinessRules.prototype.runPostRules=function(a){var b,c;for(c in this.brules)b=c.split(";"),-1<b.indexOf("__post")&&this.brules[c].apply(this,[this].concat(a))};BusinessRules.prototype.getBRuleOperator=function(a){var b=["__regexp"];a=a.split(";");var c="=";$.each(a,function(a,e){if(-1<b.indexOf(e))return c=e,!1});return c};
BusinessRules.prototype.bRuleEqualHandlers={"=":function(a,b){return-1<b.split(";").indexOf(a)},__regexp:function(a,b){var c=b.split(";"),d=!1;$.each(c,function(b,c){if(0!=c.indexOf("__"))return d=RegExp(c).test(a),!d});return d}};function FormController(){}FormController.prototype.init=function(){this.activeEntity=null;return this};function FormComponent(){}FormComponent.prototype=Object.create(BusinessRules.prototype);FormComponent.prototype.constructor=FormComponent;FormComponent.prototype.init=function(a,b,c){this.form=a;this.controller=b;this.controller.owner=this;this.extendFormConfig=null;this.dataConfig=c;this.containers={};this.untrackedItems=["combo"];return this};
FormComponent.prototype.initEvents=function(){var a=this;this.form.attachEvent("onInputChange",function(b,c,d){a.runBRule(b,b,c)});this.form.attachEvent("onChange",function(b,c,d){"input"!=a.form.getItemType(b)&&a.runBRule(b,b,c)});this.form.attachEvent("onBlur",function(a){});this.form.attachEvent("onButtonClick",function(b){a.runButtonBRule(b,b)});return this};FormComponent.prototype.setData=function(a){this.controller.activeEntity=a;this.fillFormData(a,this.dataConfig)};
FormComponent.prototype.fillFormData=function(a,b){var c=this;$.each(b,function(b,e){var f=e.input,g=e.property,h=c.form.getItemType(f),g=U.getDeepValue(a,g)||"";c.form.setItemValue(f,g);-1<c.untrackedItems.indexOf(h)&&c.runBRule(f,f,g)})};FormComponent.prototype.getSnapshot=function(){var a=this.form.getFormData();return JSON.stringify(a)};FormComponent.prototype.takeSnapshot=function(){this.snapshot=this.getSnapshot();return this};
FormComponent.prototype.updateData=function(a){var b=this.form.getFormData();a=a||this.controller.activeEntity;return this.fillEntity(a,this.dataConfig,b)};FormComponent.prototype.fillEntity=function(a,b,c){c=c||this.form.getFormData();$.each(b,function(b,e){var f=e.property,g=e.input;f&&(g&&c.hasOwnProperty(g))&&U.setDeepValue(c[g],f,a)});return a};FormComponent.prototype.updateContainerData=function(a){var b=this.form,c=this;b.forEachItem(function(d){if("container"==b.getType(d)&&"function"==typeof c.containers[d])c.containers[d](a)})};
FormComponent.prototype.addContainersUpdate=function(a){$.extend(this.containers,a||{})};function GridController(a){this.dataManager=a}GridController.prototype.init=function(a){this.mappings=a;return this};GridController.prototype.onBeforeSelectionChange=function(a,b){return!0};GridController.prototype.onSelectionChange=function(a){a=this.owner.getOrigUserData(a);this.owner.runSelectRules(a);return this};GridController.prototype.setData=function(a){var b=this;a=Array.isArray(a)?a:[a];this.owner.runPreRules(a);$.each(a,function(a,d){b.owner.addRow(d)});this.owner.runPostRules(a)};
GridController.prototype.reloadRow=function(a,b,c,d){var e=this;this.dataManager.get(b,function(b){var g;e.owner.refreshRow(a,b);d&&(g=e.owner.getRowId(b),e.onSelectionChange(g));"function"==typeof c&&c(b)},this.mappings)};GridController.prototype.getDataArray=function(a){var b=[];$.each(this.owner.config,function(c,d){var e=U.getDeepValue(a,d.key);b.push(e)});return b};function GridComponent(){}GridComponent.prototype=Object.create(BusinessRules.prototype);GridComponent.prototype.constructor=GridComponent;
GridComponent.prototype.init=function(a,b,c){this.controller=b;this.controller.owner=this;this.grid=a;this.config=c;this.grid.setHeader(this.extractCfg(this.config,"header"));this.grid.setInitWidths(this.extractCfg(this.config,"width",100));this.grid.setColAlign(this.extractCfg(this.config,"align","right"));this.grid.setColTypes(this.extractCfg(this.config,"type","ro"));this.grid.setColSorting(this.extractCfg(this.config,"sort","na"));this.initEvents();return this};
GridComponent.prototype.extractCfg=function(a,b,c){var d=[];$.each(a,function(a,f){d.push(f[b]||c||"")});return d.join(",")};GridComponent.prototype.clear=function(){this.grid.clearAll();this.controller.onSelectionChange();return this};GridComponent.prototype.removeSelected=function(){this.grid.deleteSelectedRows();this.grid.clearSelection();return this};GridComponent.prototype.clearSelection=function(){this.grid.clearSelection();return this};
GridComponent.prototype.initEvents=function(){var a=this;this.grid.attachEvent("onBeforeSelect",function(b,c){return b==c?!0:a.controller.onBeforeSelectionChange(b,c)});this.grid.attachEvent("onSelectStateChanged",function(b){a.controller.onSelectionChange(b)});return this};GridComponent.prototype.addRow=function(a,b){var c=this.controller.getDataArray(a),d=this.getRowId(a);this.grid.addRow(d,c);this.setOrigUserData(a);!0===b&&this.grid.selectRowById(d,!1,!0,!0)};
GridComponent.prototype.refreshRow=function(a,b){var c=this.getRowId(b);c!=a&&this.grid.changeRowId(a,c);var d=this.controller.getDataArray(b);this.grid.forEachCell(c,function(a,b){a.setValue(d[b])});this.setOrigUserData(b)};GridComponent.prototype.setOrigUserData=function(a){var b=this.getRowId(a);this.grid.setUserData(b,"orig",a)};GridComponent.prototype.getOrigUserData=function(a){return this.grid.getUserData(a,"orig")};
GridComponent.prototype.runSelectRules=function(a){this.runBRule("_select_",a,a);return this};GridComponent.prototype.getRowId=function(a){return"_"+this.controller.dataManager.getId(a)};GridComponent.prototype.getSelectedData=function(){var a,b=this.grid.getSelectedRowId();U.hasContent(b)&&(a=this.getOrigUserData(b));return a};function DataManager(a,b){this.cfg={idField:"_id"};$.extend(!0,this.cfg,b||{});this.service=a}DataManager.prototype.get=function(a,b,c){this.service.getEntity(a,b,c)};DataManager.prototype.save=function(a,b){this.service.save(a,b)};DataManager.prototype.prepare=function(a){var b,c=this;Array.isArray(a)?$.each(a,function(a,b){c.prepare(b)}):(b=Object.keys(a),a._isNew&&delete a[this.cfg.idField],$.each(b,function(b,e){0==e.indexOf("_")&&e!=c.cfg.idField?delete a[e]:U.isObject(a[e])&&c.prepare(a[e])}))};
DataManager.prototype["delete"]=function(a,b){if(U.hasContent(a))this.service["delete"](a,b);else"function"===typeof b&&b()};DataManager.prototype.createNewEntity=function(){return this.service._entity()};DataManager.prototype.getId=function(a){return a[this.cfg.idField]};DataManager.prototype.isNew=function(a){return!!a._isNew};DataManager.prototype.exec=function(a,b){this.service[a].apply(this.service,b)};function Toolbar(){}Toolbar.prototype.init=function(a){this.dhXToolbar=a;this.features=[];this.initEvents();return this};Toolbar.prototype.addFeatures=function(){var a=this;$.each(arguments,function(b,c){a.features[c.name]=c;switch(c.type){case "button":a.dhXToolbar.addButton(c.name,null,c.label,c.image,c.imageDis);break;case "spacer":a.dhXToolbar.addSpacer(c.name);break;case "separator":a.dhXToolbar.addSeparator(U.getRandomString())}});return this};
Toolbar.prototype.initEvents=function(){var a=this;this.dhXToolbar.attachEvent("onClick",function(b){b=a.features[b].exec;"function"==typeof b&&b()});return this};function GenericFeature(){}GenericFeature.prototype.init=function(a){this.type=a.type;this.name=a.name;this.label=a.label;this.image=a.image;this.imageDis=a.imageDis;return this};GenericFeature.prototype.exec=function(){};GenericFeature.prototype.isEnabled=function(){};GenericFeature.prototype.isVisible=function(){};
