define("../views-dependencies/constructor/module-view-level.js ../views-dependencies/constructor/module-view-levels-config.js ../views-dependencies/constructor/module-view-src-editor.js ../views-dependencies/constructor/module-view-test-data-viewer.js ../service/ConstructorService.js ../service/LevelService.js ../../ace/ace.js /static/js/bower_components/vkBeautify/vkbeautify.js".split(" "),function(z,k,r,s,w,A){function x(a,b){c.progressOn();w.list(a.controller.mappings,function(d){c.progressOff();
a.clear();a.controller.setData(d);"function"===typeof b&&b()})}function B(a,b){a.addBRules({"__btn;add_level":function(a,b){l.add()}});b.addBRules({_select_:function(a,b){U.hasContent(b)?b._isNew?q(b):l.loadEntity(b._id,q):q(b)}})}function C(){for(var a=m.length-1;-1<a;)e["delete"](m[a]),a--}function q(a){r.setValue(JSON.stringify(a));t.setData(a);k.removeAll();k.setData(a.levelConfig);D(a)}function D(a){C();a.levels&&Object.keys(a.levels)&&$.each(a.levels,function(a,d){var c=e.add();c.setData(d);
c.addCodeListener(k.getCodeListener())})}function u(){var a=t.updateData();a.levels=[];a.levelConfig=[];$.each(m,function(b,d){var c=d.getData();a.levels.push(c)});a.levelConfig=k.getData();return a}function E(a){a&&"function"===typeof a.onSizeChange&&n.attachEvent("onPanelResizeFinish",function(b){a.onSizeChange(b)})}var p,c,n,g,t,h,m=[],v,f=new DataManager(w),F=new DataManager(A),l={add:function(){var a=f.createNewEntity();g.addRow(a,!0)},"delete":function(){c.progressOn();var a=u();if(a)if(a._isNew)c.progressOff(),
g.removeSelected();else if(U.hasContent(a._id))f["delete"](a._id,function(){c.progressOff();g.removeSelected()})},save:function(a){c.progressOn();var b=u(),d=f.isNew(b),e=f.getId(b);f.prepare(b);f.save(b,function(b){var f=g.grid.getSelectedRowId();d&&(e=b);g.controller.reloadRow(f,e,function(){c.progressOff();"function"==typeof a&&a()},!0)})},reload:function(a){x(g)},loadEntity:function(a,b){c.progressOn();f.get(a,function(a){c.progressOff();b(a)})},test:function(){var a=g.getSelectedData(),b=s.getContainer();
a&&(b.expand(),b.progressOn(),f.exec("test",[a._id,{onSuccess:function(a){s.setData(JSON.stringify(a));b.progressOff()},onError:function(a){b.progressOff()}}]))}},e={add:function(){var a=U.getRandomString(),b;h.addTab(a);b=h.cells(a);b=z().init(b);b.getComponent().containerCellId=a;h.cells(a).setActive();m.push(b);return b},"delete":function(a){h.getActiveTab();var b=m.indexOf(a),d=null;-1<b&&(d=a.getComponent(),m.splice(b,1),h.cells(d.containerCellId).close())},deleteActive:function(){var a=e.getActive();
if(a)e["delete"](a)},getActive:function(){var a,b=h.getActiveTab();$.each(m,function(d,c){if(c.getComponent().containerCellId==b)return a=c,!1});return a},next:function(){h.goToNextTab()},prev:function(){h.goToPrevTab()},setData:function(){},getData:function(){}},y={add:function(a){var b=a.getCode();k.addItem(b);a.addCodeListener(k.getCodeListener())},remove:function(a){a=a.getCode();k.removeItem(a)}},G=[function(){var a=(new GenericFeature).init({label:"Reload",type:"button",name:"reload",image:"/static/images/button_reload.png",
imageDis:"/static/images/button_reload.png"});a.exec=l.reload;return a}(),function(){var a=(new GenericFeature).init({label:"Add",type:"button",name:"add",image:"/static/images/button_add.png",imageDis:"/static/images/button_add.png"});a.exec=l.add;return a}(),function(){var a=(new GenericFeature).init({label:"Delete",type:"button",name:"delete",image:"/static/images/button_delete.png",imageDis:"/static/images/button_delete.png"});a.exec=function(){vv.confirm(vvMes.del,function(a){if(a)l["delete"]()})};
return a}(),function(){var a=(new GenericFeature).init({label:"Save",type:"button",name:"save",image:"/static/images/button_save.png",imageDis:"/static/images/button_save.png"});a.exec=l.save;return a}(),function(){var a=(new GenericFeature).init({label:"Test",type:"button",name:"test",image:"/static/images/button_test.png",imageDis:"/static/images/button_test.png"});a.exec=function(){l.test()};return a}()],H=[function(){var a=(new GenericFeature).init({label:"Add level",type:"button",name:"addLevel",
image:"/static/images/button_add.png",imageDis:"/static/images/button_add.png"});a.exec=function(){var a=e.add(),c=F.createNewEntity();a.setData(c);y.add(a)};return a}(),function(){var a=(new GenericFeature).init({label:"Delete level",type:"button",name:"deleteLevel",image:"/static/images/button_delete.png",imageDis:"/static/images/button_delete.png"});a.exec=function(){vv.confirm(vvMes.del,function(a){var c=e.getActive();a&&c&&(y.remove(c),e["delete"](c))})};return a}(),{type:"separator"},function(){var a=
(new GenericFeature).init({type:"button",name:"prevLevel",image:"/static/images/button_left.png",imageDis:"/static/images/button_left.png"});a.exec=e.prev;return a}(),function(){var a=(new GenericFeature).init({type:"button",name:"nextLevel",image:"/static/images/button_right.png",imageDis:"/static/images/button_right.png"});a.exec=e.next;return a}()];return p={init:function(a){c=a;a=c.attachLayout("4H");a.cells("a").hideHeader();a.cells("a").hideArrow();a.cells("a").setWidth(420);a.cells("b").setHeight(220);
a.cells("b").hideHeader();a.cells("b").hideArrow();a.cells("c").hideHeader();a.cells("c").hideArrow();a.cells("d").collapse();n=a;a=n.cells("a").attachGrid();var b=(new GridController(f)).init([{property:"_id",input:"_id"},{property:"code",input:"code"},{property:"url",input:"url"}]),b=(new GridComponent).init(a,b,[{key:"code",header:"Code",width:100},{key:"url",header:"Url",width:300}]);a.setImagePath("/static/dhtmlx/imgs");a.init();x(b);g=b;a=n.attachToolbar();a=(new Toolbar).init(a);a.addFeatures.apply(a,
G);a=g;var b=n.cells("b").attachForm([{type:"settings",inputWidth:200,labelWidth:100,labelAlign:"left"},{type:"fieldset",label:"Page Details",width:350,offsetLeft:15,list:[{type:"input",name:"_id",label:"Id",readonly:!0},{type:"input",name:"code",label:"Code",required:!0},{type:"input",name:"url",label:"Url",required:!0},{type:"input",name:"parentSel",label:"Parent Selector",required:!0},{type:"input",name:"listKey",label:"List Key",required:!0}]},{type:"newcolumn",offset:5},{type:"fieldset",label:"Levels Config",
width:"auto",offsetLeft:15,list:[{type:"container",name:"levels_config",inputWidth:400,inputHeight:144}]},{type:"newcolumn",offset:5}]),d=(new FormController).init(),b=(new FormComponent).init(b,d,[{property:"_id",input:"_id"},{property:"code",input:"code"},{property:"url",input:"url"},{property:"parentSel",input:"parentSel"},{property:"listKey",input:"listKey"}]).initEvents();B(b,a);b.addContainersUpdate({});a=t=b;k.init().setForm(a.form.getContainer("levels_config"));a=n;b=a.cells("c").attachSidebar({template:"icons",
single_cell:!1,width:50});a.cells("c").hideHeader();b.addItem({id:"forms",icon:"/static/images/forms.png"});b.addItem({id:"source",icon:"/static/images/src.png"});b.cells("forms").setActive();v=b;a=v.cells("forms").attachLayout("1C");a.base.className+=" src_levels";b=a.cells("a").attachToolbar();b=(new Toolbar).init(b);b.addFeatures.apply(b,H);h=a.cells("a").attachTabbar({arrows_mode:!1});a=v.cells("source").attachLayout("1C");a.base.className+=" src_editor";a.cells("a").hideHeader();r.init(a).setDataSource(p);
a=n.cells("d");s.init(a);E(r);return p},destruct:function(){return p},updateData:function(a){var b=u(),b=JSON.parse(JSON.stringify(b));a&&f.prepare(b);return b},setData:function(a){q(a);return p}}});
